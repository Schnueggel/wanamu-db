box: golio/ubuntu:latest
build:
  steps:
    - script:
        name: Pseudo
        code: |
          export
deploy:
  steps:
    - add-ssh-key:
        keyname: OVH_KEY
    - script:
        name: install ssh
        code: |
          ssh-agent -s
    - script:
        name: Deploy
        code: |
          ssh -l $DEPLOY_USER -o UserKnownHostsFile=/dev/null -tt -o StrictHostKeyChecking=no $DEPLOY_HOST /bin/bash -e <<EOF
          sudo ./dockerinstall.sh $WERCKER_GIT_REPOSITORY $WERCKER_GIT_BRANCH
          sudo ./dockerinstall.sh $WU_DB_MIGRATION_REPO $WERCKER_GIT_BRANCH
          cd ./$WERCKER_GIT_REPOSITORY
          sudo -E docker-compose build
          sudo -E docker-compose up -d
          sudo -E docker-compose run wanamudbmigration
          echo hund
          ~.
          ~#
          exit
          EOF
  after-steps:
    - slack-notifier:
        url: $SLACK_WEBHOOK_URL
        channel: wercker-notify
        username: werckerbot